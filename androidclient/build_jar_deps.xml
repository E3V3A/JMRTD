<?xml version="1.0" encoding="UTF-8"?>

<!--
   Builds jmrtd.jar and cert-cvc.jar in libs/ with references to scprov instead of bcprov.
   Depends on the presence of a cert-cvc.jar and on the presence of a passporthostapi project in the current workspace.
-->

<project name="bjmrtd" default="jars" basedir=".">

    <property name="software" value="c:/Software" />
	<property name="bcprov" value="bcprov-jdk15on-147.jar" />

	<path id="compile.classpath">
		<fileset dir="${software}/cert-cvc-1.3.0" includes="cert-cvc.jar" />
		<fileset dir="${software}/crypto-147/jars" includes="${bcprov}" />
	</path>

	<target name="init">
		<mkdir dir="../passporthostapi/build" />
		<mkdir dir="libs" />
	</target>

	<target name="compile" depends="init">
		<javac destdir="../passporthostapi/build" debug="on"
			includeantruntime="no" encoding="iso8859-1" target="1.6">
			<classpath refid="compile.classpath" />
			<src
				path="../passporthostapi/src:../scuba_util/src:../scuba_smartcards/src:../scuba_sc_indep/src" />
		</javac>
	</target>

	<target name="jars" depends="compile">
		<taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask"
			classpath="${software}/jarjar-1.3.jar" />

		<jarjar jarfile="libs/cert-cvc.jar">
			<manifest>
				<attribute name="Implementation-Title"
					value="EAC 1.11 Card Verifiable Certificate Library" />
				<attribute name="Implementation-Version" value="1.3.0b" />
				<attribute name="Implementation-Vendor"
					value="Keijo Kurkinen, Swedish National Police Board" />
				<attribute name="License" value="LGPL" />
			</manifest>
			<zipfileset dir="${software}/cert-cvc-1.3.0" includes="cert-cvc.jar" />
			<rule pattern="org.bouncycastle.**" result="org.spongycastle.@1" />
		</jarjar>

		<jarjar jarfile="libs/jmrtd.jar">
			<manifest>
				<attribute name="Implementation-Title" value="JMRTD host API (including SCUBA)" />
				<attribute name="Implementation-Version" value="0.4.8b" />
				<attribute name="Implementation-Vendor" value="The JMRTD team" />
				<attribute name="License" value="LGPL" />
			</manifest>
			<fileset dir="../passporthostapi/build" includes="**/*.class" />
			<rule pattern="org.bouncycastle.**" result="org.spongycastle.@1" />
		</jarjar>

		<copy todir="libs">
			<fileset dir="${software}" includes="scprov-jdk15on-1.47.0.1.jar" />
			<fileset dir="${software}/jj2000-read-only/target" includes="jj2000-5.2-SNAPSHOT.jar" />			
		</copy>
		
	</target>

</project>
